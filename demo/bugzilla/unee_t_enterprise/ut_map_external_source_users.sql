CREATE TABLE `ut_map_external_source_users` (
  `id_map` int(11) NOT NULL AUTO_INCREMENT COMMENT 'Id in this table',
  `syst_created_datetime` timestamp NULL DEFAULT NULL COMMENT 'When was this record created?',
  `creation_system_id` int(11) DEFAULT NULL COMMENT 'What is the id of the sytem that was used for the creation of the record?',
  `created_by_id` varchar(255) COLLATE utf8mb4_unicode_520_ci DEFAULT NULL COMMENT 'The MEFE ID of the user who created this record',
  `creation_method` varchar(255) COLLATE utf8mb4_unicode_520_ci DEFAULT NULL COMMENT 'How was this record created',
  `syst_updated_datetime` timestamp NULL DEFAULT NULL COMMENT 'When was this record last updated?',
  `update_system_id` int(11) DEFAULT NULL COMMENT 'What is the id of the sytem that was used for the last update the record?',
  `updated_by_id` varchar(255) COLLATE utf8mb4_unicode_520_ci DEFAULT NULL COMMENT 'The MEFE ID of the user who updated this record',
  `update_method` varchar(255) COLLATE utf8mb4_unicode_520_ci DEFAULT NULL COMMENT 'How was this record updated?',
  `organization_id` int(11) unsigned NOT NULL COMMENT 'a FK to the table `uneet_enterprise_organizations` The ID of the organization that created this record',
  `is_obsolete` tinyint(1) DEFAULT '0' COMMENT '1 if we need to remove this unit from the mapping',
  `is_update_needed` tinyint(1) DEFAULT '0' COMMENT '1 if we need to propagate that to downstream systens',
  `person_id` int(11) DEFAULT NULL COMMENT 'A FK to the table `persons`',
  `unee_t_mefe_user_id` varchar(255) COLLATE utf8mb4_unicode_520_ci DEFAULT NULL COMMENT 'The MEFE ID of the user - a FK to the Mongo Collection `users`',
  `unee_t_mefe_user_api_key` varchar(255) COLLATE utf8mb4_unicode_520_ci DEFAULT NULL COMMENT 'The MEFE API key that this user can use to get info via the Unee-T APis.',
  `uneet_created_datetime` timestamp NULL DEFAULT NULL COMMENT 'Timestamp when the user was created in Unee-T',
  `is_mefe_api_success` tinyint(1) DEFAULT '0' COMMENT '1 if this is a success, 0 if not',
  `mefe_api_error_message` text COLLATE utf8mb4_unicode_520_ci COMMENT 'The error message from the MEFE API (if applicable)',
  `is_unee_t_created_by_me` tinyint(1) DEFAULT '0' COMMENT '1 if this unit has been created by this or 0 if the user was existing in Unee-T before',
  `uneet_login_name` varchar(255) COLLATE utf8mb4_unicode_520_ci NOT NULL COMMENT 'The login name of the user in the BZ database',
  `external_person_id` varchar(255) COLLATE utf8mb4_unicode_520_ci NOT NULL COMMENT 'The ID in the IPI table for this record',
  `external_system` varchar(255) COLLATE utf8mb4_unicode_520_ci NOT NULL COMMENT 'The name of the external source of truth',
  `table_in_external_system` varchar(255) COLLATE utf8mb4_unicode_520_ci NOT NULL COMMENT 'The name of the table in the extrenal source of truth where the info is stored',
  PRIMARY KEY (`external_person_id`,`external_system`,`table_in_external_system`,`organization_id`),
  UNIQUE KEY `unique_mefe_user_id` (`unee_t_mefe_user_id`),
  UNIQUE KEY `unee-t_user_person` (`person_id`),
  KEY `id_map` (`id_map`),
  KEY `mefe_user_organization_id` (`organization_id`),
  CONSTRAINT `mefe_user_organization_id` FOREIGN KEY (`organization_id`) REFERENCES `uneet_enterprise_organizations` (`id_organization`) ON UPDATE CASCADE,
  CONSTRAINT `unee-t_user_person` FOREIGN KEY (`person_id`) REFERENCES `persons` (`id_person`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_520_ci;
